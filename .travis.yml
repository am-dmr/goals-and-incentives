branches:
  only:
  - master
  - staging
cache: bundler
language: ruby
services:
  - postgresql
rvm:
- 2.7.1
env:
- DATABASE_URL=postgres://postgres@127.0.0.1:5432/goals-test SECRET_TOKEN=abcdefabcdefabcdef
before_install:
  - gem install bundler
install:
  - bundle install
  - nvm install node
  - node -v
  - npm i -g yarn
  - yarn
script:
  - bundle exec bundler-audit update && bundle exec bundler-audit check
  - bundle exec rubocop
  - RAILS_ENV=test bundle exec rake db:create
  - RAILS_ENV=test bundle exec rake db:migrate
  - yarn install --ignore-engines
  - RAILS_ENV=test bundle exec rails webpacker:compile
  - bundle exec rspec
